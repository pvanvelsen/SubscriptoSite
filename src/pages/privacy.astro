---
import BaseLayout from '../layouts/BaseLayout.astro';
import Logo from '../components/Logo.astro';
import { readFile } from 'node:fs/promises';
import { join } from 'node:path';

// Read and parse the privacy policy markdown
const privacyMd = await readFile(join(process.cwd(), 'src/content/privacy.md'), 'utf-8');

// Simple markdown to HTML conversion for headings and paragraphs
function markdownToHtml(md: string): string {
  return md
    // H2 headers
    .replace(/^## (.+)$/gm, '<h2 id="$1">$1</h2>')
    // H3 headers
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    // Bold text
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    // Links
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
    // Paragraphs
    .replace(/^([^<\n#*-].+)$/gm, '<p>$1</p>')
    // Line breaks
    .replace(/\n\n/g, '\n')
    // Horizontal rules
    .replace(/^---$/gm, '<hr />');
}

const privacyHtml = markdownToHtml(privacyMd);
---

<BaseLayout
  title="Privacy Policy"
  description="Subscripto Privacy Policy - Learn how we collect, use, and protect your subscription tracking data."
>
  <div class="min-h-screen">
    <!-- Header -->
    <header class="surface elevation-1 sticky top-0 z-10">
      <div class="max-w-5xl mx-auto px-6 sm:px-8 lg:px-12 flex items-center justify-between header-padding">
        <a href="/" class="hover:opacity-80 transition-opacity">
          <Logo size="small" />
        </a>
        <a
          href="/"
          class="label-large text-[var(--color-primary)] dark:text-[var(--color-primary-dark)] hover:opacity-80 transition-opacity flex items-center gap-3"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back
        </a>
      </div>
    </header>

    <!-- Privacy Policy Content -->
    <main class="max-w-5xl mx-auto px-6 sm:px-8 lg:px-12 main-padding">
      <!-- Surface container for better readability -->
      <article class="surface elevation-1 rounded-3xl privacy-content article-padding">
        <Fragment set:html={privacyHtml} />
      </article>

      <!-- Footer -->
      <footer class="border-t border-[var(--color-outline-variant)] dark:border-[var(--color-outline-variant-dark)] text-center footer-spacing">
        <p class="body-large text-[var(--color-on-surface-variant)] dark:text-[var(--color-on-surface-variant-dark)] leading-relaxed footer-text">
          Questions about this policy? Email us at{' '}
          <a
            href="mailto:privacy@subscripto.io"
            class="text-[var(--color-primary)] dark:text-[var(--color-primary-dark)] hover:underline font-medium"
          >
            privacy@subscripto.io
          </a>
        </p>
        <p class="body-medium text-[var(--color-on-surface-variant)] dark:text-[var(--color-on-surface-variant-dark)]">
          Â© 2024 Subscripto. All rights reserved.
        </p>
      </footer>
    </main>
  </div>
</BaseLayout>

<style>
  /* Desktop spacing (default) */
  .header-padding {
    padding-top: 2rem;
    padding-bottom: 2rem;
  }

  .main-padding {
    padding-top: 5rem;
    padding-bottom: 8rem;
  }

  .article-padding {
    padding: 4rem;
  }

  .footer-spacing {
    margin-top: 8rem;
    padding-top: 3rem;
  }

  .footer-text {
    margin-bottom: 2rem;
  }

  /* Mobile spacing (640px and below) */
  @media (max-width: 640px) {
    .header-padding {
      padding-top: 1.5rem;
      padding-bottom: 1.5rem;
    }

    .main-padding {
      padding-top: 3rem;
      padding-bottom: 4rem;
    }

    .article-padding {
      padding: 2rem;
    }

    .footer-spacing {
      margin-top: 4rem;
      padding-top: 2rem;
    }

    .footer-text {
      margin-bottom: 1.5rem;
    }
  }

  /* Very small mobile (400px and below) */
  @media (max-width: 400px) {
    .header-padding {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .main-padding {
      padding-top: 2rem;
      padding-bottom: 3rem;
    }

    .article-padding {
      padding: 1.5rem;
    }

    .footer-spacing {
      margin-top: 3rem;
    }
  }

  /* Privacy Policy Content Styling - Material 3 */
  .privacy-content {
    line-height: 1.6;
  }

  .privacy-content h1 {
    font-size: 2.25rem;
    line-height: 2.75rem;
    font-weight: 400;
    margin-bottom: 1rem;
    text-align: center;
    color: var(--color-primary);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h1 {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content h2 {
    font-size: 1.5rem;
    line-height: 2rem;
    font-weight: 400;
    margin-top: 4rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-outline-variant);
    color: var(--color-on-surface);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h2 {
      color: var(--color-on-surface-dark);
      border-bottom-color: var(--color-outline-variant-dark);
    }
  }

  .privacy-content h3 {
    font-size: 1.125rem;
    line-height: 1.5rem;
    font-weight: 500;
    margin-top: 2.5rem;
    margin-bottom: 1.5rem;
    color: var(--color-primary);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h3 {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content p {
    font-size: 1rem;
    line-height: 1.875rem;
    margin-bottom: 2rem;
    color: var(--color-on-surface-variant);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content p {
      color: var(--color-on-surface-variant-dark);
    }
  }

  .privacy-content strong {
    font-weight: 500;
    color: var(--color-on-surface);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content strong {
      color: var(--color-on-surface-dark);
    }
  }

  .privacy-content a {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: opacity 0.2s;
  }

  .privacy-content a:hover {
    opacity: 0.8;
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content a {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content hr {
    margin: 2.5rem 0;
    border: none;
    border-top: 1px solid var(--color-outline-variant);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content hr {
      border-top-color: var(--color-outline-variant-dark);
    }
  }

  /* First element spacing */
  .privacy-content > *:first-child {
    margin-top: 0;
  }

  /* Print styles */
  @media print {
    header {
      display: none;
    }

    .privacy-content {
      box-shadow: none !important;
      padding: 0 !important;
    }

    .privacy-content h1 {
      font-size: 18pt;
    }

    .privacy-content h2 {
      font-size: 14pt;
      page-break-after: avoid;
    }

    .privacy-content h3 {
      font-size: 12pt;
      page-break-after: avoid;
    }

    .privacy-content p {
      font-size: 11pt;
    }
  }

  /* Mobile responsiveness */
  @media (max-width: 640px) {
    .privacy-content h1 {
      font-size: 1.875rem;
      line-height: 2.25rem;
    }

    .privacy-content h2 {
      font-size: 1.25rem;
      line-height: 1.75rem;
    }

    .privacy-content h3 {
      font-size: 1rem;
      line-height: 1.5rem;
    }

    .privacy-content p {
      font-size: 0.9375rem;
      line-height: 1.625rem;
    }
  }
</style>
